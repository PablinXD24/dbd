<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Precision Barbers - Liquidglass Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* =========================================
           1. CONFIGURA√á√ïES GLOBAIS & VARI√ÅVEIS
           ========================================= */
        :root {
            --primary: #000000;
            --text: #FFFFFF;
            --accent: #FF6B00;
            --accent-glow: rgba(255, 107, 0, 0.5);
            
            /* Glass Variables */
            --glass-bg: rgba(20, 20, 20, 0.65);
            --glass-border: rgba(255, 255, 255, 0.08);
            --glass-highlight: rgba(255, 255, 255, 0.15);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
            --blur-strength: 16px;
            
            --font-main: 'Inter', sans-serif;
            --font-display: 'Space Grotesk', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-main);
            background-color: var(--primary);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* =========================================
           2. LIQUID BACKGROUND (Fundo Animado)
           ========================================= */
        .liquid-wrapper {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; overflow: hidden; background: #050505;
        }

        .liquid-orb {
            position: absolute; border-radius: 50%;
            filter: blur(80px); opacity: 0.6;
            animation: float 10s infinite ease-in-out alternate;
        }

        .orb-1 {
            width: 50vw; height: 50vw;
            background: radial-gradient(circle, var(--accent), transparent 70%);
            top: -10%; left: -10%; animation-duration: 15s;
        }

        .orb-2 {
            width: 40vw; height: 40vw;
            background: radial-gradient(circle, #cc4400, transparent 70%);
            bottom: -10%; right: -10%; animation-duration: 12s; animation-delay: -5s;
        }

        .orb-3 {
            width: 30vw; height: 30vw;
            background: radial-gradient(circle, #ff8833, transparent 70%);
            top: 40%; left: 40%; animation-duration: 20s; opacity: 0.3;
        }

        @keyframes float {
            0% { transform: translate(0, 0) scale(1); }
            50% { transform: translate(30px, 40px) scale(1.1); }
            100% { transform: translate(-20px, -20px) scale(0.9); }
        }

        .noise-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; opacity: 0.05; pointer-events: none;
            background: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MDAiIGhlaWdodD0iNTAwIj48ZmlsdGVyIGlkPSJub2lzZSI+PGZlVHVyYnVsZW5jZSB0eXBlPSJmcmFjdGFsTm9pc2UiIGJhc2VGcmVxdWVuY3k9IjAuNjUiIG51bU9jdGF2ZXM9IjMiIHN0aXRjaFRpbGVzPSJzdGl0Y2giLz48L2ZpbHRlcj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWx0ZXI9InVybCgjbm9pc2UpIiBvcGFjaXR5PSIxIi8+PC9zdmc+');
        }

        /* =========================================
           3. ESTILOS GLASSMORPHISM
           ========================================= */
        .glass-effect {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--blur-strength));
            -webkit-backdrop-filter: blur(var(--blur-strength));
            border: 1px solid var(--glass-border);
            border-top: 1px solid var(--glass-highlight);
            border-left: 1px solid var(--glass-highlight);
            box-shadow: var(--glass-shadow);
            border-radius: 24px;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; }

        /* Navbar */
        .navbar {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 1200px; z-index: 1000;
            padding: 1rem 2rem; border-radius: 50px;
        }
        .navbar .container { display: flex; justify-content: space-between; align-items: center; padding: 0; }
        
        .logo { display: flex; align-items: center; gap: 10px; text-decoration: none; }
        .logo-icon { font-size: 1.5rem; color: var(--accent); text-shadow: 0 0 15px var(--accent-glow); }
        .logo-text { display: flex; flex-direction: column; line-height: 1; }
        .logo-primary { font-family: var(--font-display); font-weight: 700; font-size: 1.2rem; color: #fff; }
        .logo-secondary { font-size: 0.7rem; letter-spacing: 3px; color: var(--accent); }

        .nav-links { display: flex; gap: 2rem; align-items: center; }
        .nav-link { text-decoration: none; color: rgba(255,255,255,0.7); font-weight: 500; transition: 0.3s; position: relative; }
        .nav-link:hover, .nav-link.active { color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.5); }
        .nav-link.active::after {
            content: ''; position: absolute; bottom: -5px; left: 50%; transform: translateX(-50%);
            width: 20px; height: 2px; background: var(--accent); box-shadow: 0 0 10px var(--accent);
        }

        /* Bot√µes & Inputs */
        .btn-primary {
            background: linear-gradient(135deg, var(--accent), #cc5500);
            color: #fff; border: none; padding: 12px 30px; border-radius: 30px;
            font-weight: 600; cursor: pointer; transition: all 0.3s ease;
            display: inline-flex; align-items: center; gap: 10px;
            box-shadow: 0 4px 15px var(--accent-glow);
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px var(--accent-glow); }
        .btn-primary:disabled { filter: grayscale(1); cursor: not-allowed; }

        .btn-secondary {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            color: #fff; padding: 12px 30px; border-radius: 30px; cursor: pointer;
            transition: 0.3s; display: inline-flex; align-items: center; gap: 10px;
        }
        .btn-secondary:hover { background: rgba(255,255,255,0.1); border-color: var(--accent); }
        .btn-secondary.active { background: var(--accent); border-color: var(--accent); }

        .btn-icon {
            width: 40px; height: 40px; border-radius: 50%; border: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.05); color: #fff; cursor: pointer;
            display: flex; align-items: center; justify-content: center; transition: 0.3s;
        }
        .btn-icon:hover { background: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }

        input, select {
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px; padding: 15px; color: #fff; transition: 0.3s; outline: none;
        }
        input:focus { border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); }

        /* P√°ginas */
        .page { display: none; padding-top: 140px; min-height: 100vh; animation: fadeIn 0.6s ease-out; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Componentes Espec√≠ficos */
        .hero-title { font-family: var(--font-display); font-size: 4rem; line-height: 1.1; margin-bottom: 1.5rem; text-align: center; }
        .hero-gradient { background: linear-gradient(to right, #fff, var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .highlight { color: var(--accent); }
        
        .services-grid, .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 2rem; }
        .card { padding: 2rem; transition: 0.4s; cursor: pointer; position: relative; overflow: hidden; }
        .card:hover { transform: scale(1.03); border-color: var(--accent); box-shadow: 0 10px 40px rgba(255, 107, 0, 0.15); }
        .card.selected { border-color: var(--accent); background: rgba(255, 107, 0, 0.1); }

        /* Modais */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(10px); z-index: 2000;
            display: none; align-items: center; justify-content: center; padding: 1rem;
        }
        .modal-container { width: 100%; max-width: 450px; max-height: 90vh; overflow-y: auto; padding: 2rem; }

        /* Utilidades */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        
        /* Mobile */
        .menu-toggle { display: none; background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; }
        @media (max-width: 768px) {
            .navbar { width: 100%; top: 0; border-radius: 0; background: rgba(10,10,10, 0.95); }
            .menu-toggle { display: block; }
            .nav-links {
                position: absolute; top: 100%; left: 0; width: 100%; flex-direction: column;
                background: rgba(10,10,10,0.98); padding: 2rem; clip-path: circle(0% at 100% 0%);
                transition: 0.5s ease-in-out;
            }
            .nav-links.active { clip-path: circle(150% at 100% 0%); }
            .hero-title { font-size: 2.5rem; }
            .step-label { display: none; }
        }
    </style>
</head>
<body>

    <div class="liquid-wrapper">
        <div class="liquid-orb orb-1"></div>
        <div class="liquid-orb orb-2"></div>
        <div class="liquid-orb orb-3"></div>
        <div class="noise-overlay"></div>
    </div>

    <nav class="navbar glass-effect">
        <div class="container">
            <a href="#" class="logo" onclick="showPage('home')">
                <div class="logo-icon"><i class="fas fa-cut"></i></div>
                <div class="logo-text">
                    <span class="logo-primary">PRECISION</span>
                    <span class="logo-secondary">LIQUID</span>
                </div>
            </a>
            
            <div class="nav-links">
                <a href="#" data-page="home" class="nav-link active">Home</a>
                <a href="#" data-page="agendar" class="nav-link">Agendar</a>
                <a href="#" data-page="meus-agendamentos" class="nav-link">Meus Cortes</a>
                <a href="#" data-page="admin" class="nav-link hidden">Admin</a>
                
                <div class="user-section">
                    <a href="#" id="login-btn" class="btn-primary">
                        <i class="fas fa-user"></i> <span id="user-status">Entrar</span>
                    </a>
                    <button id="logout-btn" class="btn-icon hidden">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
            
            <button class="menu-toggle"><i class="fas fa-bars"></i></button>
        </div>
    </nav>

    <main id="content">
        
        <section id="home-page" class="page active">
            <div class="container text-center" style="margin-top: 4rem;">
                <span class="highlight" style="border: 1px solid var(--accent); padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; letter-spacing: 2px;">ESTILO & PRECIS√ÉO</span>
                <h1 class="hero-title" style="margin-top: 2rem;">PRECISION <br><span class="hero-gradient">LIQUID STYLE</span></h1>
                <p style="color: rgba(255,255,255,0.7); max-width: 600px; margin: 0 auto 3rem;">
                    Agende seu hor√°rio com os melhores profissionais. Ambiente moderno, t√©cnica cl√°ssica.
                </p>
                
                <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                    <button class="btn-primary" onclick="showPage('agendar')">Agendar Agora</button>
                    <button class="btn-secondary" onclick="showPage('meus-agendamentos')">Ver Meus Hor√°rios</button>
                </div>

                <div class="services-grid" style="margin-top: 5rem;">
                    <div class="card glass-effect">
                        <i class="fas fa-cut" style="font-size: 2rem; color: var(--accent); margin-bottom: 1rem;"></i>
                        <h3>Corte Cabelo</h3>
                        <p>Estilo moderno ou cl√°ssico.</p>
                    </div>
                    <div class="card glass-effect">
                        <i class="fas fa-user-tie" style="font-size: 2rem; color: var(--accent); margin-bottom: 1rem;"></i>
                        <h3>Barba Completa</h3>
                        <p>Toalha quente e navalha.</p>
                    </div>
                    <div class="card glass-effect">
                        <i class="fas fa-spray-can" style="font-size: 2rem; color: var(--accent); margin-bottom: 1rem;"></i>
                        <h3>Acabamento</h3>
                        <p>Pezinho e sobrancelha.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="agendar-page" class="page">
            <div class="container">
                <h2 class="section-title text-center">Novo <span class="highlight">Agendamento</span></h2>
                
                <div style="display: flex; justify-content: space-between; margin: 2rem 0; position: relative;">
                    <div style="position: absolute; top: 15px; left: 0; width: 100%; height: 2px; background: rgba(255,255,255,0.1); z-index: -1;"></div>
                    <div class="progress-step active" id="p-step-1" style="background: var(--primary); padding: 0 10px;"><div style="width: 30px; height: 30px; background: var(--accent); border-radius: 50%; display: flex; justify-content: center; align-items: center;">1</div></div>
                    <div class="progress-step" id="p-step-2" style="background: var(--primary); padding: 0 10px;"><div style="width: 30px; height: 30px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; justify-content: center; align-items: center;">2</div></div>
                    <div class="progress-step" id="p-step-3" style="background: var(--primary); padding: 0 10px;"><div style="width: 30px; height: 30px; background: rgba(255,255,255,0.1); border-radius: 50%; display: flex; justify-content: center; align-items: center;">3</div></div>
                </div>

                <div id="step-1" class="step-content glass-effect" style="padding: 2rem;">
                    <h3>Escolha o Servi√ßo</h3>
                    <div class="grid-container" id="booking-services"></div>
                </div>

                <div id="step-2" class="step-content hidden glass-effect" style="padding: 2rem;">
                    <h3>Escolha o Profissional</h3>
                    <div class="grid-container" id="booking-barbers"></div>
                    <div style="margin-top: 2rem;">
                        <button class="btn-secondary" onclick="changeStep(1)">Voltar</button>
                    </div>
                </div>

                <div id="step-3" class="step-content hidden glass-effect" style="padding: 2rem;">
                    <h3>Data e Hora</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 1rem;">
                        <div>
                            <input type="date" id="booking-date" class="input-glass" onchange="generateTimeSlots()">
                        </div>
                        <div id="time-slots" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px;">
                            </div>
                    </div>
                    <div style="margin-top: 2rem; display: flex; justify-content: space-between;">
                        <button class="btn-secondary" onclick="changeStep(2)">Voltar</button>
                        <button class="btn-primary" id="confirm-booking-btn">Confirmar</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="meus-agendamentos-page" class="page">
            <div class="container">
                <h2 class="section-title text-center">Meus <span class="highlight">Cortes</span></h2>
                <div id="upcoming-list" style="margin-top: 2rem;"></div>
            </div>
        </section>

        <section id="admin-page" class="page">
            <div class="container">
                <h2 class="section-title text-center">Painel <span class="highlight">Admin</span></h2>
                
                <div id="admin-content" class="hidden">
                    <div style="display: flex; gap: 10px; margin-bottom: 2rem; overflow-x: auto;">
                        <button class="btn-secondary active admin-tab" data-tab="adm-dash">Dashboard</button>
                        <button class="btn-secondary admin-tab" data-tab="adm-users">Usu√°rios</button>
                        <button class="btn-secondary admin-tab" data-tab="adm-config">Configura√ß√µes</button>
                    </div>

                    <div id="adm-dash" class="admin-panel active">
                        <div class="grid-container">
                            <div class="card glass-effect">
                                <h3>Agendamentos</h3>
                                <p style="font-size: 2rem; color: var(--accent);">0</p>
                            </div>
                            <div class="card glass-effect">
                                <h3>Receita</h3>
                                <p style="font-size: 2rem; color: var(--accent);">R$ 0,00</p>
                            </div>
                        </div>
                        <h3 style="margin-top: 2rem;">√öltimos Agendamentos</h3>
                        <div id="admin-appointments-list" style="margin-top: 1rem;"></div>
                    </div>
                    
                    <div id="adm-users" class="admin-panel hidden">
                        <p>Lista de usu√°rios (Em desenvolvimento)</p>
                    </div>

                    <div id="adm-config" class="admin-panel hidden">
                        <div id="super-admin-area-container"></div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="login-modal" class="modal-overlay">
        <div class="modal-container glass-effect">
            <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                <h2>Acesso</h2>
                <button class="btn-icon modal-close"><i class="fas fa-times"></i></button>
            </div>
            
            <div style="display: flex; gap: 10px; margin-bottom: 1rem;">
                <button class="btn-secondary active" style="flex: 1;" onclick="toggleAuthMode('login')">Login</button>
                <button class="btn-secondary" style="flex: 1;" onclick="toggleAuthMode('register')">Cadastro</button>
            </div>

            <form id="login-form">
                <div style="margin-bottom: 1rem;"><input type="email" id="login-email" placeholder="E-mail" required></div>
                <div style="margin-bottom: 1rem;"><input type="password" id="login-password" placeholder="Senha" required></div>
                <button type="submit" class="btn-primary" style="width: 100%;">Entrar</button>
            </form>

            <form id="register-form" class="hidden">
                <div style="margin-bottom: 1rem;"><input type="text" id="reg-name" placeholder="Nome" required></div>
                <div style="margin-bottom: 1rem;"><input type="email" id="reg-email" placeholder="E-mail" required></div>
                <div style="margin-bottom: 1rem;"><input type="password" id="reg-pass" placeholder="Senha (min 6)" required></div>
                <button type="submit" class="btn-primary" style="width: 100%;">Criar Conta</button>
            </form>
        </div>
    </div>

    <div id="notification" class="glass-effect hidden" style="position: fixed; top: 20px; right: 20px; padding: 1rem 2rem; border-left: 4px solid var(--accent); z-index: 3000;">
        <span id="notif-msg">Mensagem</span>
    </div>

    <div id="loading-overlay" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 4000; display: flex; align-items: center; justify-content: center;">
        <div style="width: 50px; height: 50px; border: 4px solid var(--accent); border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite;"></div>
    </div>
    <style>@keyframes spin { to { transform: rotate(360deg); } }</style>

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script>
        // 1. CONFIGURA√á√ÉO FIREBASE & SUPER ADMIN
        const firebaseConfig = {
            apiKey: "AIzaSyCHR2POfEPFGG-AbajaEsnBk32bvrru5uM",
            authDomain: "dbyd-5201e.firebaseapp.com",
            projectId: "dbyd-5201e",
            storageBucket: "dbyd-5201e.firebasestorage.app",
            messagingSenderId: "376910752424",
            appId: "1:376910752424:web:d64d958c177bdd01e3f09d"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // O E-MAIL DO CHEFE
        const SUPER_ADMIN_EMAIL = "pablo11ssousa2@gmail.com";

        // ESTADO GLOBAL
        const state = {
            user: null,
            isAdmin: false,
            isSuperAdmin: false,
            booking: { service: null, barber: null, date: null, time: null }
        };

        // DADOS MOCKADOS (Exemplo para funcionamento visual imediato)
        const servicesData = [
            { id: '1', nome: 'Corte Degrade', preco: 45 },
            { id: '2', nome: 'Barba Terapia', preco: 35 },
            { id: '3', nome: 'Combo Completo', preco: 70 }
        ];
        const barbersData = [
            { id: '1', nome: 'Carlos Silva' },
            { id: '2', nome: 'Andr√© Santos' }
        ];

        // 2. INICIALIZA√á√ÉO E AUTH
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthState();
            setupNavigation();
            setupAuthForms();
            setupBookingFlow();
        });

        function checkAuthState() {
            auth.onAuthStateChanged(async (user) => {
                state.user = user;
                if (user) {
                    document.getElementById('user-status').textContent = user.email.split('@')[0];
                    document.getElementById('login-btn').classList.add('hidden');
                    document.getElementById('logout-btn').classList.remove('hidden');
                    
                    // VERIFICA√á√ÉO SUPER ADMIN (PABLO)
                    if (user.email === SUPER_ADMIN_EMAIL) {
                        state.isAdmin = true;
                        state.isSuperAdmin = true;
                        
                        // Garante o poder no banco sem ir no console
                        await db.collection('usuarios').doc(user.uid).set({
                            admin: true, superAdmin: true, email: user.email
                        }, { merge: true });

                        showNotification('Bem-vindo Chefe Pablo! üëë');
                        document.querySelector('[data-page="admin"]').classList.remove('hidden');
                    } else {
                        // Verifica usu√°rio comum no banco
                        const doc = await db.collection('usuarios').doc(user.uid).get();
                        if(doc.exists && doc.data().admin) {
                            state.isAdmin = true;
                            document.querySelector('[data-page="admin"]').classList.remove('hidden');
                        }
                    }
                    loadAppointments();
                } else {
                    resetState();
                }
            });
        }

        function resetState() {
            state.user = null; state.isAdmin = false; state.isSuperAdmin = false;
            document.getElementById('user-status').textContent = 'Entrar';
            document.getElementById('login-btn').classList.remove('hidden');
            document.getElementById('logout-btn').classList.add('hidden');
            document.querySelector('[data-page="admin"]').classList.add('hidden');
        }

        // 3. NAVEGA√á√ÉO
        function setupNavigation() {
            document.querySelectorAll('[data-page]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    showPage(link.dataset.page);
                    // Mobile menu toggle logic here if needed
                });
            });

            document.getElementById('logout-btn').addEventListener('click', () => {
                auth.signOut();
                showPage('home');
                showNotification('Logout efetuado');
            });
            
            // Menu Mobile
            document.querySelector('.menu-toggle').addEventListener('click', () => {
                document.querySelector('.nav-links').classList.toggle('active');
            });
            
            // Modal Close
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', () => document.getElementById('login-modal').style.display = 'none');
            });

            // Login Btn
            document.getElementById('login-btn').addEventListener('click', (e) => {
                e.preventDefault();
                if(!state.user) document.getElementById('login-modal').style.display = 'flex';
            });
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId + '-page').classList.add('active');
            
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            const activeLink = document.querySelector(`[data-page="${pageId}"]`);
            if(activeLink) activeLink.classList.add('active');

            if(pageId === 'admin') initAdminPanel();
        }

        // 4. AUTENTICA√á√ÉO FORMS
        function toggleAuthMode(mode) {
            if(mode === 'login') {
                document.getElementById('login-form').classList.remove('hidden');
                document.getElementById('register-form').classList.add('hidden');
            } else {
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('register-form').classList.remove('hidden');
            }
        }

        function setupAuthForms() {
            document.getElementById('login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                showLoading(true);
                try {
                    await auth.signInWithEmailAndPassword(
                        document.getElementById('login-email').value,
                        document.getElementById('login-password').value
                    );
                    document.getElementById('login-modal').style.display = 'none';
                } catch(err) { showNotification('Erro no login: ' + err.message); }
                showLoading(false);
            });

            document.getElementById('register-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                showLoading(true);
                try {
                    const email = document.getElementById('reg-email').value;
                    const cred = await auth.createUserWithEmailAndPassword(
                        email,
                        document.getElementById('reg-pass').value
                    );
                    
                    // Se for o Pablo se cadastrando agora, j√° d√° admin
                    const isPablo = email === SUPER_ADMIN_EMAIL;
                    await db.collection('usuarios').doc(cred.user.uid).set({
                        nome: document.getElementById('reg-name').value,
                        email: email,
                        admin: isPablo,
                        superAdmin: isPablo
                    });
                    
                    document.getElementById('login-modal').style.display = 'none';
                    showNotification('Conta criada com sucesso!');
                } catch(err) { showNotification('Erro no cadastro: ' + err.message); }
                showLoading(false);
            });
        }

        // 5. AGENDAMENTO
        function setupBookingFlow() {
            const container = document.getElementById('booking-services');
            container.innerHTML = servicesData.map(s => `
                <div class="card glass-effect" onclick="selectService('${s.id}')">
                    <h4>${s.nome}</h4>
                    <p class="highlight">R$ ${s.preco},00</p>
                </div>
            `).join('');

            const barberContainer = document.getElementById('booking-barbers');
            barberContainer.innerHTML = barbersData.map(b => `
                <div class="card glass-effect" onclick="selectBarber('${b.id}')">
                    <i class="fas fa-user"></i> <h4>${b.nome}</h4>
                </div>
            `).join('');

            document.getElementById('confirm-booking-btn').addEventListener('click', confirmBooking);
        }

        function selectService(id) {
            state.booking.service = servicesData.find(s => s.id === id);
            changeStep(2);
        }
        function selectBarber(id) {
            state.booking.barber = barbersData.find(b => b.id === id);
            changeStep(3);
        }

        function changeStep(step) {
            document.querySelectorAll('.step-content').forEach(el => el.classList.add('hidden'));
            document.getElementById('step-'+step).classList.remove('hidden');
            
            // Bolinhas
            document.querySelectorAll('.progress-step div').forEach(d => {d.style.background='rgba(255,255,255,0.1)';});
            for(let i=1; i<=step; i++) {
                document.querySelector('#p-step-'+i+' div').style.background = 'var(--accent)';
            }
        }

        function generateTimeSlots() {
            const date = document.getElementById('booking-date').value;
            state.booking.date = date;
            const slots = ['09:00', '10:00', '11:00', '14:00', '15:00', '16:00'];
            const container = document.getElementById('time-slots');
            container.innerHTML = slots.map(t => `
                <div style="padding: 10px; border: 1px solid white; border-radius: 5px; text-align: center; cursor: pointer;" 
                     onclick="state.booking.time = '${t}'; this.style.background='var(--accent)'">
                    ${t}
                </div>
            `).join('');
        }

        async function confirmBooking() {
            if(!state.user) { showNotification('Fa√ßa login primeiro'); return; }
            if(!state.booking.time) { showNotification('Escolha um hor√°rio'); return; }
            
            showLoading(true);
            try {
                await db.collection('agendamentos').add({
                    uid: state.user.uid,
                    ...state.booking,
                    createdAt: new Date()
                });
                showNotification('Agendado com sucesso!');
                showPage('meus-agendamentos');
                changeStep(1); // Reset
            } catch(e) { console.error(e); }
            showLoading(false);
        }

        async function loadAppointments() {
            const snapshot = await db.collection('agendamentos')
                .where('uid', '==', state.user.uid).get();
            
            const list = document.getElementById('upcoming-list');
            if(snapshot.empty) { list.innerHTML = '<p>Sem agendamentos.</p>'; return; }

            list.innerHTML = snapshot.docs.map(doc => {
                const d = doc.data();
                return `
                <div class="card glass-effect" style="margin-bottom: 1rem; display: flex; justify-content: space-between;">
                    <div>
                        <h4>${d.service.nome}</h4>
                        <p>${d.date} √†s ${d.time}</p>
                    </div>
                    <div class="highlight">R$ ${d.service.preco}</div>
                </div>`;
            }).join('');
        }

        // 6. ADMINISTRA√á√ÉO & SUPER ADMIN (PABLO)
        function initAdminPanel() {
            document.querySelectorAll('.admin-tab').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.admin-panel').forEach(p => p.classList.add('hidden'));
                    document.getElementById(btn.dataset.tab).classList.remove('hidden');
                });
            });

            // L√≥gica Exclusiva do Super Admin
            if(state.isSuperAdmin) {
                const configContainer = document.getElementById('super-admin-area-container');
                configContainer.innerHTML = `
                    <div class="card glass-effect" style="border: 1px solid var(--accent);">
                        <h3 style="color: var(--accent); margin-bottom: 1rem;"><i class="fas fa-crown"></i> √Årea do Chefe</h3>
                        <p style="margin-bottom: 10px;">Adicionar novo Administrador:</p>
                        <div style="display: flex; gap: 10px;">
                            <input type="email" id="new-admin-email" placeholder="E-mail do usu√°rio" style="background: rgba(0,0,0,0.5);">
                            <button class="btn-primary" onclick="promoteAdmin()">Promover</button>
                        </div>
                    </div>
                `;
            }
        }

        async function promoteAdmin() {
            const email = document.getElementById('new-admin-email').value;
            if(!email) return showNotification('Digite o e-mail');
            
            showLoading(true);
            try {
                const snapshot = await db.collection('usuarios').where('email', '==', email).get();
                if(snapshot.empty) throw new Error('Usu√°rio n√£o encontrado. Ele precisa criar conta primeiro.');
                
                const userDoc = snapshot.docs[0];
                await db.collection('usuarios').doc(userDoc.id).update({ admin: true });
                
                showNotification(`Sucesso! ${email} agora √© Admin.`);
                document.getElementById('new-admin-email').value = '';
            } catch(e) {
                showNotification(e.message);
            }
            showLoading(false);
        }

        // UTILIT√ÅRIOS
        function showNotification(msg) {
            const n = document.getElementById('notification');
            document.getElementById('notif-msg').textContent = msg;
            n.classList.remove('hidden');
            setTimeout(() => n.classList.add('hidden'), 3000);
        }
        function showLoading(show) {
            const l = document.getElementById('loading-overlay');
            if(show) l.classList.remove('hidden'); else l.classList.add('hidden');
        }

    </script>
</body>
</html>
